# バックアップ対象セッション → GitHubアーカイブ（v1.2）

> **重要**：このプロンプトは、**Issue本文/コメントに運用SOP（手順や方針の説明）を混入させない**ように設計されています。
> **Issue本文/コメント＝セッション由来の内容のみ**、運用SOPは**末尾の「操作案内」ブロック**に限定表示（**本文へは出力禁止**）とします。

---

## 目的

このチャットセッションを **Driedsandwich / gpt-session-archive** の **GitHub Issues** へ「**1セッション=1Issue**」として保存します。
**アシスタント側**で、タイトル／本文要約／詳細（多段コメント）を自動生成し、まず**プレビューのみ**を提示してください。
**私が `post:` 指示を出した場合にのみ**、**MCP**で実投稿します。

---

## 入力

* **本チャットのURL**：

> ※上記以外（タイトル・要約・詳細・目次用サマリ）は**アシスタントが生成**。
> URL未入力でも進行可（`source_url: 未記載`）。

---

## 出力境界（厳守）

**Issue本文とコメントには、セッション内容“のみ”を記載**し、**運用SOP/方針/操作説明は出力しない**。
以下のような**SOP語が含まれる段落は本文・コメントから除去**する（プレビュー生成後に自動フィルタ）。

* 例：

  * 「保存方針：本文は要約、詳細は…」
  * 「投稿オペレーション：まず新規Issueを作成し…」
  * 「目次Issue：本文最上段へ…」
  * 「セキュリティ：機微は…[MASKED]」
  * 「末尾表記は— 続く／— 完」 等
    → これらは**後述の「操作案内」ブロック**にのみ記載（本文・コメントへ**出力禁止**）。

---

## 生成仕様（プレビュー段階で提示するもの）

### 1) Issueタイトル案（日本語・**主題｜副題**・日付/時刻は入れない）

* 生成基準：セッション本文から**主題（名詞句）**＋**到達点/決定（短い述語句）**を抽出
* 例：`プロンプト整理｜バックアップ手順を確定`

### 2) Issue本文案（`source_url:`＋要約300–500字、**段落/箇条書きで改行多め**）

```
source_url: <本チャットのURL または 未記載>

概要
- 目的：……
- 主要トピック：……
- 決定事項：……
- 未決事項：……
（機微は [MASKED]）
```

### 3) 【目次用サマリ（120字）】＋【補足（任意・個数自由）】

```
【目次用サマリ（120字）】
……（主要結論を120字前後で）

【補足（任意・個数自由）】
- ……（20–40字目安）
- ……
```

### 4) コメント案（詳細の多段・**章立て＋改行**）

* 推奨章立て：Rationale（背景/前提）→ Evidence（根拠/抜粋）→ Decision（結論）→ Action（次アクション）
* **1コメント=初手 900–1,100字**目安で自動分割
* 各Part先頭に `Part n/m` を付与

### 5) 操作案内（プレビューにのみ表示／**本文・コメントへ出力禁止**）

```
投稿する場合は：
post: 新規
または
post: 追記 #<番号>
```

---

## 目次 #26 の更新手順（**安全PREPEND**）

* 追記形式：**本文の最上段**に1行追加（最新順）。**既存本文は必ず保持**。
* 行テンプレ（**全角「｜」必須**）：

```
| <主題>｜<副題> | #<番号> | <120字サマリ> |
```

* **二重防止**：更新前に #26 本文の**直近数行**を読み取り、`#<番号>` の前方一致があれば**スキップ**して結果を報告。
* **通信/競合失敗時フォールバック**：本文更新が失敗した場合は、**同じ1行をコメント**で投稿（後日、本文へ集約）。

---

## 分割・表記・再試行ルール（厳守）

* **サイズ上限**：各コメント **30KB未満**（UTF-8）
* **文字数安全域**：初手 **900–1,100字/コメント**

  * 失敗時は **1,100 → 900 → 700** の順で段階縮小
* **投稿間隔（バックオフ）**：**10秒 → 20秒 → 30秒**（最大2回リトライ）
* **末尾表記**：

  * **中間Part**（`Part 1/m`〜`Part (m-1)/m`）：末尾に **`— 続く`**
  * **最終Part**（`Part m/m`）：末尾に **`— 完`**
  * **単独の独立投稿**（分割なし）：末尾表記なし

---

## マスキング（セキュリティ）

* トークン／個人情報／内部URL等の**機微は必ず** **`[MASKED]`**。
* `source_url` は私が入力したURLのみ反映（未入力なら**未記載**）。
* **日付/時刻は書かない**（GitHubが自動記録）。

---

## 前/後チェック（自動検査）

* **前チェック（投稿前）**：

  * Issue本文/コメント案に**SOP語**（「保存方針：」「投稿オペレーション：」「目次Issue：」「セキュリティ：…[MASKED]」等）が**含まれていないか**を検査→**該当段落は削除**。
  * 各コメントの**サイズ/字数が安全域**に収まっているか。
* **後チェック（投稿後）**：

  * 目次#26が**PREPEND**で更新され、**最上段が当該 #<番号>** になっているか。
  * フォールバック（コメント代替）発生時は**その旨を報告**。

---

## 実行フロー（アシスタントの手順）

1. **生成**：本文のみを根拠に、**タイトル（主題｜副題）**、**本文要約（改行・箇条書き）**、**詳細（多段コメント案）**、**目次用サマリ（120字＋任意補足）**を作成。`source_url:` は入力URLがあれば反映、なければ未記載。
2. **プレビュー提示**：上記一式＋**操作案内**を**1返答**で表示（この段階では投稿しない）。
3. **投稿トリガ**：`post: 新規` または `post: 追記 #<番号>` にのみ反応して**実投稿**。

   * **本文/コメント出力からSOP語を除去**（前チェック）
   * 403/サイズ超過は**段階縮小＋バックオフ**で再試行
   * **目次#26**：**PREPEND**で1行追加（失敗→コメント代替）
4. **完了報告**：Issue URL、実分割数、目次更新方式（本文/コメント）、再試行の有無を**短報**。

---

## プレビュー例（体裁）

**Issueタイトル案**

```
プロンプト整理｜バックアップ手順を確定
```

**Issue本文案**

```
source_url: https://chatgpt.com/c/123456789

概要
- 目的：バックアップ手順の確認と合意内容の文書化
- 主要トピック：分割投稿 / 末尾表記 / 目次PREPEND
- 決定事項：中間は「— 続く」、最終は「— 完」、単独は末尾なし
- 未決事項：目次フォールバックの集約担当（後日）
（機微は [MASKED]）
```

**【目次用サマリ（120字）】＋【補足（任意・個数自由）】**

```
【目次用サマリ（120字）】
分割投稿と末尾表記を統一し、403回避と可読性を両立。目次は本文PREPENDで最新順に整列。

【補足（任意・個数自由）】
- 初手900–1,100字、安全域確保
- 失敗時は1100→900→700で縮小
- 送信間隔は10→20→30秒
```

**コメント案（多段）**

```
Part 1/3
Rationale
- ……
Evidence
- ……
— 続く

Part 2/3
Decision
- ……
Action
- ……
— 続く

Part 3/3
Follow-ups
- ……
— 完
```

**操作案内（プレビュー専用／本文・コメントへ出力禁止）**

```
投稿する場合は：
post: 新規
または
post: 追記 #<番号>
```

---

## ガードレール

* **本文/コメント＝セッション由来の内容のみ**。SOP語・操作説明は**本文・コメントへ出力禁止**。
* **中間Part末尾は必ず `— 続く`／最終のみ `— 完`／単独は末尾表記なし**。
* **目次#26**は**PREPEND**（既存本文保持）。失敗時は**コメント代替**で1行を必ず残す。
* **機微は常に `[MASKED]`**。内部URLも原則マスク（公開安全が明確な場合に限り残す）。
* **日付は書かない**（GitHubの自動記録に依存）。
